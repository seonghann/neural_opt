# config file for load dataset
# train contains batch_size, num_workers

train:
  batch_size: 32
  num_workers: 8
  # num_workers: 1
  # lambda_train: 0 # 0.01
  # lambda_valid: 0 # 0.01
  lambda_x_train: 0
  lambda_q_train: 0
  lambda_r_train: 1
  lambda_x_valid: 0
  lambda_q_valid: 0
  lambda_r_valid: 1
  clip_grad: 5  # float, null to disable
  progress_bar: False
  weight_decay: 1e-12
  optimizer: adamw
  seed: 1994
  lr: 0.001
  epochs: 10000

  check_val_every_n_epoch: 30000
  sample_every_n_batch: 30000
  sample_every_n_valid: 30000

  projection: True  # True or False
  # noise_type: euclidean  # euclidean or manifold
  noise_type: manifold  # euclidean or manifold

dataset:
  name: Geodesic2DFT
  datadir: 'data'
  raw_datadir: 'data/raw/GeodesictoDFT'

debug:
  save_dir: './debug'
  save_dynamic:

general:
  name: 'schnet-test4'
  # name: 'debug'
  use_wandb: True
  wandb: 'online'
  save_model: True
  gpus: 1
  strategy: auto  # 'deepspeed'  # auto, ddp, fsdp, deepspeed,
  resume: # ckpt path
  test_only: # /home/ksh/MolDiff/NeuralOpt/neural_opt/pl_test/checkpoints/fourth/epoch=96.ckpt
  evaluate_all_checkpoints:

sampling:
  stochastic: True
  sde_dt: 0.05
  gode_iter: 50
  gode_ref_dt: 0.05
  gode_max_dt: 0.1
  time_margin: 0.05

model:
  append_coordinate: False  # True or False
  reduced_dimension: False # True or False
  name: condensed
  pred_type: edge  # edge or node
  hidden_dim: 128
  num_bond_type: 10
  num_atom_type: 4
  num_atom_feat: 8
  score_act: 'silu'
  edge_cat_act: 'silu'
  edge_encoder:
    name: 'gaussian'
    cutoff: 10
    activation: 'silu'
  graph_encoder:
    name: 'schnet'
    node_dim: 128
    time_dim: 256
    edge_dim: 128
    num_filters: 128
    num_convs: 8
    cutoff: 10.0
    smooth_conv: False

diffusion:
  scheduler:
    name: 'bellcurve'
    sigma_min: 2e-06
    sigma_max: 0.001
    beta_std: 0.125

manifold:
  ode_solver:
    vpae_thresh: 0.03  # percent error threshold
    alpha: 1.6
    beta: 2.3
    svd_tol: 1e-4
    iter: 30
    max_iter: 1000
    ref_dt: 5e-2
    _ref_dt: 1e-3
    max_dt: 1e-1
    _max_dt: 5e-2
    min_dt: 1e-3
    _min_dt: 1e-4
    pos_adjust_scaler: 0.03
    pos_adjust_thresh: 3e-3
    q_type: DM
